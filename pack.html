<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Suivi Pack</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f9f9f9;
      color: #333;
      padding: 10px;
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 20px;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 400px;
      margin: auto;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    select, input, button {
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background: #27ae60;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #219150;
    }
    .result {
      margin-top: 20px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .articles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .article-box {
      border: 2px solid #000;
      border-radius: 8px;
      background-color: #fff;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .article-label {
      background-color: #000;
      color: #fff;
      font-size: 1.1rem;
      font-weight: bold;
      padding: 5px;
      text-align: center;
    }
    .article-size {
      font-size: 1rem;
      color: #333;
      text-align: center;
      padding: 10px;
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .missing {
      background-color: #ffdddd !important;
      border-color: red !important;
    }
    @media (max-width: 600px) {
      h1 { font-size: 1.5rem; }
      .article-label { font-size: 1rem; }
      .article-size { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <h1>Suivi de votre Pack</h1>
  <form id="searchForm">
    <select id="club" required>
      <option value="">-- Sélectionnez votre club --</option>
      <option value="RFCB Sprimont">RFCB Sprimont</option>
      <option value="Bas-Oha">Bas-Oha</option>
      <option value="Union Hutoise">Union Hutoise</option>
      <option value="Ellas">Ellas</option>
      <option value="JSN">JSN</option>
    </select>
    <input type="text" id="firstname" placeholder="Prénom" required>
    <input type="text" id="lastname" placeholder="Nom" required>
    <button type="submit">Rechercher</button>
  </form>

  <div id="result" class="result" style="display:none;"></div>

  <script>
    const articleValueMapping = {
      "Veste": "jacket_size",
      "Pantalon": "pants_size",
      "Kit": "kit_size",
      "Sous-maillot": "under_shirt_size",
      "Bas": "bas_size",
      "Maillot": "jersey_size",
      "Short": "short_size",
      "Polo": "polo_size",
      "K-Way": "option_kway",
      "Bas2": "option_bas",
      "Initiales": "initials_requested"
    };

    const roleArticlesConfig = {
      "Joueur": ["Veste", "Pantalon", "Maillot", "Short", "Bas"],
      "Joueur-WBO": ["Veste", "Pantalon", "Bas", "Sous-maillot", "Maillot", "Short", "K-Way", "Bas2"],
      "Keeper-WBO": ["Veste", "Pantalon", "Bas", "Sous-maillot", "Maillot", "Short", "K-Way", "Bas2"],
      "U10-U21": ["Veste", "Pantalon", "Polo", "Bas", "Short", "Maillot"],
      "Entraineur": ["Veste", "Pantalon", "Short", "Maillot"],
      "Ellas-Entraineur": ["Veste", "Pantalon", "Short", "Polo"],
      "Ellas-Keeper": ["Veste", "Pantalon", "Kit"],
      "Ellas-Joueur": ["Veste", "Pantalon", "Kit", "Bas"],
      "Joueur-JSN": ["Veste", "Pantalon"],
      "Entraineur-JSN": ["Veste", "Pantalon"],
      "Joueur-Hannut": ["Veste", "Pantalon", "Bas", "Maillot"],
      "Keeper-Hannut": ["Veste", "Pantalon", "Bas", "Maillot"],
    };

    document.getElementById('searchForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const club = document.getElementById('club').value;
      const firstname = document.getElementById('firstname').value.trim();
      const lastname = document.getElementById('lastname').value.trim();

fetch(`get_order_by_name.php?club=${encodeURIComponent(club)}&firstname=${encodeURIComponent(firstname)}&lastname=${encodeURIComponent(lastname)}`)
        .then(res => res.json())
        .then(response => {
          if (!response.success) {
            document.getElementById('result').style.display = 'block';
            document.getElementById('result').innerHTML = `<p style="color:red;">${response.message || 'Aucune commande trouvée'}</p>`;
            return;
          }

          const order = response.order;
          const roleKey = order.role;
          const articles = roleArticlesConfig[roleKey] || [];

          let html = `
            <h2>${order.club}</h2>
            <p><strong>Nom :</strong> ${order.firstname} ${order.name}</p>
            <p><strong>Catégorie :</strong> ${order.category}</p>
            <p><strong>Rôle :</strong> ${order.role}</p>
            <div class="articles-grid">
          `;

          articles.forEach(label => {
            const key = articleValueMapping[label];
            let value = order[key] || "—";
            let isMissing = false;

            if (label === "K-Way") {
              value = order.option_kway || "Non";
              isMissing = order.kway_missing == 1;
            } else if (label === "Initiales") {
              value = order.initials_requested ? order.initials : "Non";
              isMissing = order.initials_missing == 1;
            } else {
              const baseKey = key.replace('_size', '');
              isMissing = order[baseKey + '_missing'] == 1;
            }

            html += `
              <div class="article-box ${isMissing ? 'missing' : ''}">
                <div class="article-label">${label}</div>
                <div class="article-size">${value}</div>
              </div>
            `;
          });

          html += `</div>`;
          document.getElementById('result').innerHTML = html;
          document.getElementById('result').style.display = 'block';
        })
        .catch(err => {
          console.error(err);
          alert("Erreur lors de la récupération des données.");
        });
    });
  </script>
</body>
</html>
